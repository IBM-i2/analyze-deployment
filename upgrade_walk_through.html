<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Upgrading a distributed deployment to version 4.4.3 of i2 Analyze </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Upgrading a distributed deployment to version 4.4.3 of i2 Analyze ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="images/favicon.png">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="guidetoc/toc.html">
    
    <meta property="docfx:rel" content="">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <strong>i2 Analyze</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="upgrading-a-distributed-deployment-to-version-443-of-i2-analyze">Upgrading a distributed deployment to version 4.4.3 of i2 Analyze</h1>

<p>To upgrade the distributed deployment example, you must run an upgrade command on each server in your deployment. The following instructions detail what is required on each container, and how to use these steps to upgrade i2 Analyze on physical servers.</p>
<h2 id="before-you-begin">Before you begin</h2>
<ul>
<li>You must have a working distributed deployment of a previous version of i2 Analyze, completed with a previous version of the distributed deployment example.</li>
</ul>
<h3 id="important">Important</h3>
<ul>
<li>If you are upgrading a distributed deployment that was created by using V2.6.x or earlier of the distributed deployment example, you must use the <code>/opt/IBM/i2analyze</code> path instead of <code>/opt/i2/i2analyze</code> in the Docker commands on this page.</li>
<li>If you are upgrading a distributed deployment that was created by using V1.x of the distributed deployment example, you must not update your distributed deployment example source code. Continue to use the same scripts, images, and containers from V1.x of the distributed deployment example.</li>
<li>You must run any commands on the Docker container as the <code>root</code> user instead of the <code>i2analyze</code> user. For example, <code>docker exec -u root liberty /opt/i2/i2analyze/toolkit/scripts/setup -t stopLiberty</code> instead of <code>docker exec -u i2analyze liberty /opt/i2/i2analyze/toolkit/scripts/setup -t stopLiberty</code>.</li>
</ul>
<hr>
<h2 id="prerequisites-for-upgrading-the-distributed-deployment">Prerequisites for upgrading the distributed deployment</h2>
<p>Download, install, and configure the prerequisites for upgrading a distributed deployment.</p>
<h3 id="example-code">Example code</h3>
<p>Clone or download the distributed deployment example from <a href="https://github.com/i2group/analyze-deployment/releases">https://github.com/i2group/analyze-deployment/releases</a>.</p>
<p>Remove the current distributed deployment example code, but ensure the containers stay running.</p>
<p>Extract the distributed deployment example that you just downloaded.</p>
<h3 id="i2-analyze">i2 Analyze</h3>
<p>Download i2 Analyze for Linux. You download the <code>I2A_V4.4.3_LINUX.tar.gz</code> version 4.4.3 by using the usual mechanism.</p>
<ol>
<li><p>Rename the <code>tar.gz</code> file to <code>i2analyze.tar.gz</code>.</p>
</li>
<li><p>Copy the archive file to the <code>src/images/common/ubuntu_toolkit/i2analyze</code> directory.</p>
</li>
<li><p>Add the <code>mssql-jdbc-7.4.1.jre11.jar</code> file to the <code>src/configuration/environment/common/jdbc-drivers</code> directory.</p>
<blockquote><p>Note: Download the Microsoft JDBC Driver 7.4 for SQL Server from <a href="https://www.microsoft.com/download/details.aspx?id=58505">Microsoft JDBC Driver 7.4 for SQL Server</a>. Extract the contents of the <code>tar.gz</code>, and locate the <code>sqljdbc_7.4\enu\mssql-jdbc-7.4.1.jre11.jar</code> file.</p>
</blockquote>
</li>
<li><p>Add the <code>postgresql-xx.x.x.jar</code> file to the <code>src/configuration/environment/common/jdbc-drivers</code> directory.</p>
<blockquote><p>Note: Download the latest (Java 8) PostgreSQL JDBC Driver for PostgreSQL from <a href="https://jdbc.postgresql.org/download/">https://jdbc.postgresql.org/download/</a></p>
</blockquote>
</li>
</ol>
<h3 id="analysts-notebook-premium">Analyst&#39;s Notebook Premium</h3>
<p>Download <em>i2 Analyst&#39;s Notebook Premium</em> version 10 by using the usual mechanism.</p>
<p>Upgrade Analyst&#39;s Notebook Premium. For more information, see <a href="https://docs.i2group.com/analyze/upgrading_anbp.html">Upgrading i2 Analyst&#39;s Notebook Premium</a>.</p>
<hr>
<h2 id="preparing-i2-analyze">Preparing i2 Analyze</h2>
<p>Back up and install i2 Analyze before you upgrade i2 Analyze.</p>
<h3 id="stopping-liberty">Stopping Liberty</h3>
<p>Before you upgrade your deployment, you must stop the application server.</p>
<p>To stop Liberty, run the following command on the <code>liberty</code> container:</p>
<pre><code class="lang-sh">docker exec -u i2analyze liberty /opt/i2/i2analyze/toolkit/scripts/setup -t stopLiberty
</code></pre><p>The console output from the <code>stopLiberty</code> task is output directly to the console.</p>
<h3 id="backing-up-the-configuration">Backing up the configuration</h3>
<p>Before you upgrade your deployment, you must backup your current configuration. In the distributed deployment example, the <code>backupConfiguration</code> script creates a copy of your configuration directory on the <code>admin_client</code> container. The backup of your configuration is in the <code>src/configuration_mods/configuration_backup</code> directory.</p>
<p>In a non-Docker environment, ensure that you have a copy of the <code>configuration</code> directory that contains your complete configuration in a location outside of the i2 Analyze toolkit. The process of upgrading i2 Analyze removes the deployment toolkit from each server in the deployment. Ensure that the backup of your configuration is up-to-date for each server in your deployment.</p>
<h3 id="installing-i2-analyze">Installing i2 Analyze</h3>
<p>You must install version 4.4.3 of i2 Analyze on each server in the deployment. In the distributed deployment example, you can use the <code>installToolkit</code> script to install i2 Analyze on each container.</p>
<p>To install i2 Analyze on each container, run the following command from the <code>src/scripts</code> directory:</p>
<pre><code class="lang-sh">./installToolkit ./images/common/ubuntu_toolkit/i2analyze/i2analyze.tar.gz
</code></pre><p>In a non-Docker environment, install i2 Analyze on each server by using the following instructions: <a href="https://docs.i2group.com/analyze/upgrading_4_1_3.html">Upgrading i2 Analyze</a>.</p>
<h3 id="copying-the-backed-up-configuration">Copying the backed up configuration</h3>
<p>In the distributed deployment example, you upgrade the configuration on the <code>admin_client</code> container. You must copy the backed up configuration of the deployment toolkit to the Admin Client.</p>
<p>To copy your backed up configuration to the <code>admin_client</code> container, run the following command from the <code>src</code> directory:</p>
<pre><code class="lang-sh">docker cp ./configuration_mods/configuration_backup admin_client:/opt/i2/i2analyze/toolkit/configuration
</code></pre><p>When the directory is copied, the owner of the directory, and all files within it, is changed. The user that runs the deployment script must be able to write to files within the <code>configuration</code> directory. To change the ownership of the directory and the files, run the following command:</p>
<pre><code class="lang-sh">docker exec -u root admin_client chown -R i2analyze:i2analyze /opt/i2/i2analyze/toolkit/configuration
</code></pre><p>The configuration is now on the <code>admin_client</code> container.</p>
<p>In a non-Docker environment, copy your backed up configuration directory to the <code>i2analyze/toolkit/configuration</code> directory on your equivalent of the Admin Client server.</p>
<hr>
<p>You can complete a quick upgrade or you can upgrade manually. Completing the upgrade manually requires you to run each of the steps completed automatically in the quick upgrade. By upgrading manually, you can see in detail what is required on each container and how to use this to upgrade a deployment on physical servers.</p>
<h2 id="quick-upgrade">Quick upgrade</h2>
<p>To upgrade the distributed deployment example, a script is provided that upgrades i2 Analyze and its components.</p>
<p>To upgrade your deployment, run the <code>./upgradeDeployment</code> script from the <code>src/scripts</code> directory.</p>
<p>All of the components of i2 Analyze are upgraded and the application is started. You can test the deployment by completing the steps in <em>Testing the deployment</em>.</p>
<hr>
<h2 id="upgrade-the-deployment-manually">Upgrade the deployment manually</h2>
<h2 id="upgrading-and-copying-the-configuration">Upgrading and copying the configuration</h2>
<p>If you are using a newer version of JDBC Drivers, remove the previous version, run the following commands from the <code>src</code> directory:</p>
<pre><code class="lang-sh">docker exec -u root admin_client rm -rf /opt/i2/i2analyze/toolkit/configuration/environment/common/jdbc-drivers
docker cp configuration/environment/common/jdbc-drivers admin_client:/opt/i2/i2analyze/toolkit/configuration/environment/common
</code></pre><p>Upgrade the i2 Analyze configuration to version 4.4.3. To upgrade the configuration, run the following command on the <code>admin_client</code> container:</p>
<pre><code class="lang-sh">docker exec -u i2analyze -t admin_client /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeConfiguration
</code></pre><p>The console output from the <code>upgradeConfiguration</code> task is output directly to the console.</p>
<p>The upgraded configuration must be copied to each of the servers in the deployment. In a Docker environment, first you must copy the upgraded configuration to your local machine by running the following command inside the <code>src/scripts</code> directory:<br>For SQL Server:</p>
<pre><code class="lang-sh">docker cp admin_client:/opt/i2/i2analyze/toolkit/configuration ../configuration_mods/sqlserver/configuration_upgraded
</code></pre><p>For Db2:</p>
<pre><code class="lang-sh">docker cp admin_client:/opt/i2/i2analyze/toolkit/configuration ../configuration_mods/db2/configuration_upgraded
</code></pre><p>For Postgres:</p>
<pre><code class="lang-sh">docker cp admin_client:/opt/i2/i2analyze/toolkit/configuration ../configuration_mods/postgres/configuration_upgraded
</code></pre><p>Then, copy the upgraded configuration to each server. In the distributed deployment example, you can run the <code>updateServerConfigurations</code> script to copy the configuration to each container:</p>
<pre><code class="lang-sh">./updateServerConfigurations configuration_upgraded
</code></pre><p>In a non-Docker environment, copy the upgraded configuration to the <code>i2analyze/toolkit/configuration</code> directory on each server.</p>
<h2 id="upgrading-and-starting-the-components-of-i2-analyze">Upgrading and starting the components of i2 Analyze</h2>
<p>After the upgraded configuration is present on each server, you must upgrade each component of the deployment to version 4.4.3.</p>
<p>You must upgrade and start the components of a deployment in the order that they are described here.</p>
<h3 id="upgrading-zookeeper">Upgrading ZooKeeper</h3>
<p>To upgrade ZooKeeper, run the following command on the <code>zookeeper</code>, <code>zookeeper2</code> and <code>zookeeper3</code> containers:</p>
<pre><code class="lang-sh">docker exec -u i2analyze zookeeper /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeZookeeper --hostname zookeeper.eianet
docker exec -u i2analyze zookeeper2 /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeZookeeper --hostname zookeeper2.eianet
docker exec -u i2analyze zookeeper3 /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeZookeeper --hostname zookeeper3.eianet
</code></pre><p>The console output from the <code>upgradeZookeeper</code> task is output directly to the console.</p>
<h3 id="upgrading-solr">Upgrading Solr</h3>
<p>To upgrade Solr, run the following command on the <code>solr</code> and <code>solr2</code> containers:</p>
<pre><code class="lang-sh">docker exec -u i2analyze solr /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeSolr --hostname solr.eianet
docker exec -u i2analyze solr2 /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeSolr --hostname solr2.eianet
</code></pre><p>The console output from the <code>upgradeSolr</code> task is output directly to the console.</p>
<h3 id="upgrading-the-information-store-database">Upgrading the Information Store database</h3>
<p>To upgrade the Information Store database, run the following command on the <code>admin_client</code> container:</p>
<pre><code class="lang-sh">docker exec -u i2analyze admin_client /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeDatabases --hostname admin_client.eianet
</code></pre><p>The console output from the <code>upgradeDatabases</code> task is output directly to the console.</p>
<h3 id="starting-zookeeper">Starting ZooKeeper</h3>
<p>To start ZooKeeper, run the following commands on the <code>zookeeper</code>, <code>zookeeper2</code> and <code>zookeeper3</code> containers:</p>
<pre><code class="lang-sh">docker exec -u i2analyze zookeeper /opt/i2/i2analyze/toolkit/scripts/setup -t startZkHosts --hostname zookeeper.eianet
docker exec -u i2analyze zookeeper2 /opt/i2/i2analyze/toolkit/scripts/setup -t startZkHosts --hostname zookeeper2.eianet
docker exec -u i2analyze zookeeper3 /opt/i2/i2analyze/toolkit/scripts/setup -t startZkHosts --hostname zookeeper3.eianet
</code></pre><p>The console output from the <code>startZkHosts</code> task is output directly to the console.</p>
<h3 id="upload-the-solr-configuration-on-zookeeper">Upload the Solr configuration on ZooKeeper</h3>
<p>To upload the Solr configuration by using the Admin client, run the following command:</p>
<pre><code class="lang-sh">docker exec -u i2analyze -t admin_client /opt/i2/i2analyze/toolkit/scripts/setup -t createAndUploadSolrConfig --hostname admin_client.eianet
</code></pre><p>The Solr configuration is uploaded.</p>
<h3 id="starting-solr">Starting Solr</h3>
<p>To start Solr, run the following commands on the <code>solr</code> and <code>solr2</code> containers:</p>
<pre><code class="lang-sh">docker exec -u i2analyze solr /opt/i2/i2analyze/toolkit/scripts/setup -t startSolr --hostname solr.eianet
docker exec -u i2analyze solr2 /opt/i2/i2analyze/toolkit/scripts/setup -t startSolr --hostname solr2.eianet
</code></pre><p>The console output from the <code>startSolr</code> tasks are displayed directly to the console.</p>
<h3 id="upgrading-the-solr-collection">Upgrading the Solr collection</h3>
<p>To upgrade the Solr collection, run the following command on the <code>admin_client</code> container:</p>
<pre><code class="lang-sh">docker exec -u i2analyze -t admin_client /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeSolrCollections --hostname admin_client.eianet
</code></pre><p>The console output from the <code>upgradeSolrCollections</code> task is output directly to the console.</p>
<h3 id="upgrading-liberty">Upgrading Liberty</h3>
<p>To upgrade Liberty and the i2 Analyze application, run the following command on the <code>liberty</code> container:</p>
<pre><code class="lang-sh">docker exec -u i2analyze -t liberty /opt/i2/i2analyze/toolkit/scripts/setup -t upgradeLiberty
</code></pre><p>The console output from the <code>upgradeLiberty</code> task is output directly to the console.</p>
<h3 id="starting-liberty">Starting Liberty</h3>
<p>Start Liberty with the upgraded i2 Analyze application.</p>
<p>To start Liberty, run the following command on the <code>liberty</code> container:</p>
<pre><code class="lang-sh">docker exec -u i2analyze liberty /opt/i2/i2analyze/toolkit/scripts/setup -t startLiberty
</code></pre><p>The console output from the <code>startLiberty</code> task is output directly to the console.</p>
<h3 id="optional-upgrading-the-etl-client">(Optional) Upgrading the ETL Client</h3>
<p>If your deployment uses an ETL Client, you must recreate it with the new upgraded toolkit.</p>
<p>In the distributed deployment example, the <code>deployEtlClient</code> script removes the old installation from your running etl_client container, creates a new etl_client in the admin_client container and copies it over to the <code>etl_client</code> container creates a copy of your configuration directory on the Admin Client container. The backup of your configuration is in the <code>src/configuration_mods/configuration_backup</code> directory.</p>
<hr>
<h2 id="results">Results</h2>
<p>All of the components of i2 Analyze are upgraded and the application is started.</p>
<hr>
<h2 id="testing-the-deployment">Testing the deployment</h2>
<p>To test the deployment upgraded successfully, connect to i2 Analyze from Analyst&#39;s Notebook Premium. The URL that you use to connect is the same as you used to before you run the upgrade process.</p>
<p>Log in using the user name <code>Jenny</code> with the password <code>Jenny</code>.</p>
<p>You can use the <strong>Upload records</strong> functionality to add data to the Information Store, and then search for that data or data that already existed.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
